---
title: 模拟退火模板及注意事项
date: 2022-07-20 10:31:17
updated: 2022-07-20 10:31:17
tags:
  - 退火
categories:
  - 算法
keywords: []
comments: true
---
## [目录](https://www.luogu.com.cn/paste/kz05fzm0)

牛马的退火模版，根据实际情况调参即可

```cpp
void sa() {
	ans=calc();//计算初始状态 
	for (double t=1000; t>1e-10; t*=0.997) {//初始温度、末温度、降温参数根据题目修改 
		......//产生一个新的状态，如果类似函数的问题则转移距离要和当前温度有关
		double/int/... now=calc(), d=now-ans; //计算新状态的价值和差距 
		if (d<0) ans=now;//如果更优直接到新的状态 
		if (exp(-1.0*d/t)*RAND_MAX<rand()) ......//如果更不优且超过一定容差则恢复原来状态 
	}
}
```

注：

1. 若最优值是最大值，则 `d<0`  需改为 `d>0`，`exp(-1.0*d/t)` 需改为 `exp(1.0*d/t)`

2. 若要记录最优答案，则在更新 $ans$ 时记录答案，但最后的状态有大概率已经是答案了。
3. 以下说法不保证一定正确。
4. 若答案很小或不同状态的差值很小，则 $t$ 初始温度应当**适当调低**，应当根据 `exp(-1.0*d/t)*RAND_MAX<rand()` 成立的概率计算出适当的初始温度，否则开始就会走很偏。
5. 末温度**降低**只会提升正确性，因为答案是随时更新的。
6. 在满足第 $4$ 点的情况下 $Δt$ 应当**适当大**，一般要高于 $0.99$，但这会影响运行时间，故可以记录时间，判断当前运行时间不会超时就继续做，但这种情况下需要保证最后的温度不能过高。
7. 在**有些**题目中有必要多做几次 SA 函数，但**很多**题目多做是徒劳的。
8. 建议不要 `srand(time(0))` 而是直接 `srand` 一个定值或者 `time(0)` 亦或上一个定值，不要问我为什么，因为我也不知道(狗头)，如果你用的是 `mt19937` 就当我放了个屁。